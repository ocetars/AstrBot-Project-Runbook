## å®šä¹‰ä¸ç›®çš„
æœ¬ç¯‡æè¿° Dev/Beta/Master ä¸‰å±‚æ¼æ–—åˆ†æ”¯æ¨¡å‹ï¼Œå…¼é¡¾å¿«é€Ÿè¿­ä»£ä¸ç°åº¦ç¨³å®šã€‚

é’ˆå¯¹ `AstrBot` è®¾è®¡äº†ä¸€å¥—ç»“åˆäº† **GitHub Flow ç®€æ˜“æ€§** ä¸ **Git Flow ç¨³å®šæ€§** çš„ä¸‰å±‚æ¼æ–—å¼åˆ†æ”¯ç®¡ç†æ–¹æ¡ˆã€‚

---

### ç¬¬äºŒéƒ¨åˆ†ï¼šå®Œç¾åˆ†æ”¯æ¨¡å‹è®¾è®¡ â€”â€” â€œä¸‰å±‚æ¼æ–—æ¨¡å‹â€

ä¸ºäº†æ»¡è¶³**ç°åº¦æµ‹è¯•**ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»£ç åº“åˆ†ä¸ºä¸‰å±‚ï¼š**å¼€å‘ï¼ˆChaosï¼‰ -> ç°åº¦ï¼ˆFilterï¼‰ -> ç¨³å®šï¼ˆSolidï¼‰**ã€‚

å»ºè®®é‡‡ç”¨ **GitLab Flow çš„å˜ä½“ï¼ˆUpstream Firstï¼‰**ã€‚

#### 1. åˆ†æ”¯ç»“æ„å›¾è§£

```text
(Feature Branches)  (Dev Branch)      (Beta/Gray Branch)     (Master/Main Branch)
     åŠŸèƒ½å¼€å‘           å¼€å‘é›†æ•£åœ°           ç°åº¦/é¢„å‘å¸ƒ               ç¨³å®šæ­£å¼ç‰ˆ
       â”‚                 â”‚                    â”‚                       â”‚
       â”œâ”€â”€ PR â”€â”€â”€â”€â”€â”€â”€â–º   â–¼                    â”‚                       â”‚
       â”‚               [dev] ğŸš§ (Alpha)       â”‚                       â”‚
       â”‚                 â”‚                    â”‚                       â”‚
       â”‚                 â”‚â”€â”€â”€ å®šæœŸåŒæ­¥ â”€â”€â”€â”€â–º   â–¼                       â”‚
       â”‚                 â”‚                  [beta] ğŸ§ª (Gray)          â”‚
       â”‚                 â”‚                    â”‚                       â”‚
       â”‚                 â”‚                    â”‚â”€â”€â”€ éªŒè¯é€šè¿‡ â”€â”€â”€â”€â”€â”€â–º    â–¼
       â”‚                 â”‚                    â”‚                     [master] ğŸš€ (Stable)
       â”‚                 â”‚                    â”‚                       â”‚
```

#### 2. è¯¦ç»†å®šä¹‰

**â‘  `dev` åˆ†æ”¯ï¼ˆå¼€å‘ä¸»è½´ / Alphaï¼‰**
*   **æƒé™ï¼š** ä»…æ ¸å¿ƒç»´æŠ¤è€…å¯åˆå¹¶ï¼Œéœ€è¿‡ CIã€‚
*   **å®šä½ï¼š** **é»˜è®¤åˆ†æ”¯ï¼ˆDefault Branchï¼‰**ã€‚æ‰€æœ‰ PR å¿…é¡»æŒ‡å‘è¿™é‡Œã€‚
*   **å—ä¼—ï¼š** æ ¸å¿ƒå¼€å‘è€…ã€æå®¢ç”¨æˆ·ã€äºŒå¼€å¼€å‘è€…ã€‚
*   **çŠ¶æ€ï¼š** æ°¸è¿œæ˜¯æœ€æ–°çš„ï¼Œå…è®¸å¶å°”æœ‰ Bugã€‚
*   **è‡ªåŠ¨åŒ–ï¼š** æ¯æ¬¡ push è§¦å‘æ„å»º `astrbot:dev` çš„ Docker é•œåƒã€‚

**â‘¡ `beta` åˆ†æ”¯ï¼ˆç°åº¦ç¼“å†²åŒº / RCï¼‰**
*   **æƒé™ï¼š** ä»… Project Lead å¯æ“ä½œï¼ˆé€šè¿‡ PR æˆ– Fast-forwardï¼‰ã€‚
*   **å®šä½ï¼š** **ç°åº¦æµ‹è¯•é€šé“**ã€‚
*   **æœºåˆ¶ï¼š**
    *   æ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆå¦‚æ¯å‘¨äº”ï¼Œæˆ–ç§¯æ”’äº† 5 ä¸ªåŠŸèƒ½åï¼‰ï¼Œå°† `dev` çš„ä»£ç åˆå¹¶åˆ° `beta`ã€‚
    *   **å…³é”®ç‚¹ï¼š** åœ¨è¿™é‡Œå‘å¸ƒ `v1.2.0-rc1` (Release Candidate) ç‰ˆæœ¬ã€‚
*   **å—ä¼—ï¼š** æ ¸å¿ƒç¾¤é‡Œçš„æ´»è·ƒç”¨æˆ·ï¼Œæ„¿æ„å¸®ä½œè€…æµ‹ Bug çš„â€œå°ç™½é¼ â€ã€‚
*   **è‡ªåŠ¨åŒ–ï¼š** è§¦å‘æ„å»º `astrbot:beta` é•œåƒã€‚

**â‘¢ `master` åˆ†æ”¯ï¼ˆç¨³å®šå‘å¸ƒåŒº / Productionï¼‰**
*   **æƒé™ï¼š** æå…¶ä¸¥æ ¼ï¼Œä»…å…è®¸ä» `beta` åˆå¹¶ã€‚**ä¸¥ç¦ç›´æ¥ Pushã€‚**
*   **å®šä½ï¼š** **æ­£å¼äº§ç‰©**ã€‚
*   **æœºåˆ¶ï¼š**
    *   å½“ `beta` åˆ†æ”¯åœ¨ç°åº¦ç¾¤é‡Œè¿è¡Œäº† 3-5 å¤©æ²¡æœ‰é‡å¤§ Bug åï¼Œå°† `beta` åˆå¹¶å…¥ `master`ã€‚
    *   **æ‰“ Tagï¼š** è¿™é‡Œæ‰“ä¸Šæ­£å¼ Tag `v1.2.0`ã€‚
*   **å—ä¼—ï¼š** 90% çš„æ™®é€šç”¨æˆ·ã€ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è€…ã€‚
*   **è‡ªåŠ¨åŒ–ï¼š** è§¦å‘æ„å»º `astrbot:latest` é•œåƒï¼Œå‘å¸ƒ GitHub Releaseã€‚

---

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šé…åˆè¿™å¥—ç³»ç»Ÿçš„â€œé«˜æ•ˆå·¥ä½œæµâ€ (The Workflow)

å…‰æœ‰åˆ†æ”¯ä¸è¡Œï¼Œå¿…é¡»é…åˆè§„å®šåŠ¨ä½œã€‚

#### 1. å¼€å‘è€…æ—¥å¸¸ (Contributor)
*   **Fork & Clone:** å¼€å‘è€… Fork é¡¹ç›®ã€‚
*   **Branch:** åŸºäº `dev` åˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feat/add-plugin dev`ã€‚
*   **PR:** æäº¤ PR åˆ° `upstream/dev`ï¼ˆæ³¨æ„ï¼š**ä¸æ˜¯** `master`ï¼‰ã€‚

#### 2. ç»´æŠ¤è€…æ—¥å¸¸ (Maintainer)
*   **Review:** åœ¨ `dev` ä¸Š Review PRã€‚
*   **Merge:** æ­¤æ—¶ CI è·‘æµ‹è¯•ã€‚åˆå¹¶åï¼Œå‘Šè¯‰ç”¨æˆ·ï¼šâ€œåŠŸèƒ½å·²è¿› devï¼Œè¯·æ‹‰å– `dev` åˆ†æ”¯æˆ–ä½¿ç”¨ `:dev` é•œåƒæµ‹è¯•ã€‚â€
*   **Wait:** ä¸éœ€è¦ç«‹åˆ»å‘ç‰ˆï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ª PRã€‚

#### 3. ç°åº¦å‘å¸ƒæµç¨‹ (Release Manager) - **æ ¸å¿ƒç¯èŠ‚**
å½“è§‰å¾—åŠŸèƒ½æ”’çš„å·®ä¸å¤šäº†ï¼Œæˆ–è€…åˆ°äº†å‘¨äº”ï¼š
1.  **åˆ›å»ºç°åº¦ PRï¼š** æä¸€ä¸ª `dev` -> `beta` çš„ PRï¼ˆæˆ–è€…ç›´æ¥æœ¬åœ° git pushï¼‰ã€‚
2.  **å‘å¸ƒå…¬å‘Šï¼š** åœ¨ Discord/QQ ç¾¤/Issue å–Šä¸€å£°ï¼šâ€œæ–°ç‰ˆæœ¬ `vX.X-beta` å·²å‘å¸ƒï¼Œè¯·æµ‹è¯•ã€‚â€
3.  **è§‚å¯Ÿï¼š** å¦‚æœæœ‰äººåé¦ˆ Bugï¼Œ**ä¸è¦åœ¨ beta ä¸Šä¿®**ï¼
    *   **Hotfix ç­–ç•¥ï¼š** åœ¨ `dev` ä¸Šä¿®å¥½ -> Cherry-pick æˆ–åˆå¹¶åˆ° `beta`ã€‚ä¿è¯ `dev` æ°¸è¿œåŒ…å«æ‰€æœ‰ä»£ç ã€‚

#### 4. æ­£å¼å‘å¸ƒæµç¨‹
ç°åº¦ N å¤©æ— æ¶æ€§ Bugï¼š
1.  `beta` -> `master`ã€‚
2.  GitHub Release è‡ªåŠ¨ç”Ÿæˆ Release Noteã€‚
3.  Docker è‡ªåŠ¨æ¨ `latest`ã€‚
